# Web Server Project

## О проекте
Минималистичный HTTP-сервер на Go, работающий поверх TCP с кастомным парсером HTTP.  
Поддерживает CRUD для пользователей, фильтрацию по ролям и ротацию логов.

Ключевые возможности:
- CRUD для пользователей (Create / Read / Update / Delete).
- Фильтрация списка пользователей по роли (query param `role`).
- Логирование через `log/slog` в stdout и в файл с ротацией при достижении 5 МБ.
- Конфигурируется через файл `.env`.

---

## Установка и запуск

1. Клонировать репозиторий и перейти в директорию:
```bash
git clone <URL_REPO>
cd web-server
```

2. Создать файл `.env` в корне проекта (пример):
```env
HOST=127.0.0.1
PORT=8888
LOG_FILE=server.log
LOG_LEVEL=info
API_BASE_PATH=/api/v1
```

3. Сборка и запуск:
```bash
go build -o web-server ./cmd/web-server
./web-server
```

Сервер будет доступен по адресу HOST:PORT, указанному в `.env`.

---

## API

Все эндпоинты начинаются с `/api/v1`.

| Метод  | Эндпоинт             | Описание                                    | Пример запроса                                                                                                              | Пример ответа                                     |
|--------|----------------------|---------------------------------------------|----------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------|
| GET    | `/api/v1/users`      | Получить всех пользователей (опционально: фильтр по роли `?role=...`) | `curl "http://127.0.0.1:8888/api/v1/users?role=admin"`                                                                      | `[{"id":1,"username":"Леха","role":"admin"}]`     |
| GET    | `/api/v1/users/{id}` | Получить пользователя по ID                  | `curl http://127.0.0.1:8888/api/v1/users/1`                                                                                 | `{"id":1,"username":"Леха","role":"admin"}`       |
| POST   | `/api/v1/users`      | Создать пользователя                         | `curl -X POST http://127.0.0.1:8888/api/v1/users -H "Content-Type: application/json" -d '{"username":"TestUser","role":"user"}'` | `{"id":4,"username":"TestUser","role":"user"}`    |
| PUT    | `/api/v1/users/{id}` | Обновить пользователя                        | `curl -X PUT http://127.0.0.1:8888/api/v1/users/4 -H "Content-Type: application/json" -d '{"username":"UpdatedUser","role":"user"}'` | `{"id":4,"username":"UpdatedUser","role":"user"}` |
| DELETE | `/api/v1/users/{id}` | Удалить пользователя                         | `curl -X DELETE http://127.0.0.1:8888/api/v1/users/4`                                                                       | пустой ответ с кодом 204                         |

Тело запроса (JSON):
```json
{"username":"TestUser","role":"user"}
```

Коды ответов:
- 200 — успех (GET / PUT)
- 201 — создано (POST)
- 204 — удалено (DELETE)
- 400 — некорректный запрос
- 404 — не найдено
- 500 — внутренняя ошибка сервера

---

## Логирование

- Используется `log/slog`.
- Логи пишутся в stdout и в файл, ротация при достижении 5 МБ.
- Уровень логирования настраивается через `.env` (LOG_LEVEL=debug|info|warn|error).

Пример лог-записи:
```
time=2025-10-22T14:50:57.922+04:00 level=INFO msg="новое подключение" address=127.0.0.1:49842
time=2025-10-22T14:50:58.011+04:00 level=INFO msg="получен запрос" method=GET path=/api/v1/users query=map[]
```

---

## Тестирование

В корне проекта есть скрипт для базового тестирования API:
```bash
./test_api.sh
```
Скрипт выполнит набор curl-запросов и выведет результаты в консоль.

---

## Структура проекта (кратко)
- cmd/web-server — точка входа (main).  
- internal — логика приложения, HTTP-парсер, обработчики.  
- pkg — общие утилиты (логи, конфиг).  
- scripts — вспомогательные скрипты (test_api.sh).

---

## Автор
Проект создан для демонстрации работы с TCP и низкоуровневым HTTP-парсером на Go. Используйте и модифицируйте по необходимости.



